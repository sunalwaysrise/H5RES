var bd={
  toggleMore:function(){
    jcDom.MoreDetail.toggle();
    jcDom.MoreLocked.toggle();
  },
  addContent: function (e) {
    this.schemes={};
    this.mul=5;
    $("#mul").html(5);
    var d=eval("("+$(e).attr('data')+")"),h=[];
    this.passWay=['2串1'];
    var r=(Number(d.hostRate)/(Number(d.hostRate)+Number(d.guestRate))*100).toFixed(0),t1,t2;
    if(d.hostV==403){
      t1='主不败:让球胜平负(+1)下的[主胜]';
    }else if(d.hostV==3){
      t1='主胜:胜平负[主胜]';
    }
    if(d.guestV==0){
      t2='客胜:胜平负[客胜]';
    }else if(d.guestV==400){
      t2='客不败:让球胜平负(-1)下的[客胜]';
    }
    h.push('<div data="{v:'+d.hostV+',r:'+d.hostRate+',n:\''+d.hostTitle+'\'}" onclick="cp2y.buy.updataScheme(this);">');
    h.push('<h3>'+d.hostName+'</h3>');
    h.push('<article><p>'+(100-r)+'</p><em>%</em><p>支持'+d.hostTitle+'</p></article>');
    h.push('<strong>'+d.hostTitle+'</strong><var onclick="cp2y.dialog.alert(\''+t1+'\');">?</var>');
    h.push('<span>赔率'+d.hostRate+'</span></div>');
    h.push('<div data="{v:'+d.guestV+',r:'+d.guestRate+',n:\''+d.guestTitle+'\'}" onclick="cp2y.buy.updataScheme(this);">');
    h.push('<h3>'+d.guestName+'</h3>');
    h.push('<article><p>'+r+'</p><em>%</em><p>支持'+d.guestTitle+'</p></article>');
    h.push('<strong>'+d.guestTitle+'</strong><var onclick="cp2y.dialog.alert(\''+t2+'\');">?</var>');
    h.push('<span>赔率'+d.guestRate+'</span></div>');
    h.push('<section><b>VS</b><time>'+d.time+'</time><span>截止时间</span></section>');
    $('#dpgL1').html(h.join("")).attr({'data':'{name:\''+d.name+'\',h:\''+d.hostName+'\',g:\''+d.guestName+'\',no:'+d.matchCode+'}'});
    if(d.matchCode==this.Dgp[1][1]){//确定配比赛事
      this.PB=this.Dgp[0];
    }else{
      this.PB=this.Dgp[1];
    }
    this.step2();
    this.schemes[this.PB[1]]={
      dan:false,
      name:this.PB[10],
      h:this.PB[2],
      g:this.PB[6],
      no:this.PB[1],
      v:[this.PB[3],this.PB[7]],
      r:[this.PB[5],this.PB[9]],
      n:[this.PB[4],this.PB[8]]
    };
  },
  updataScheme:function(e){
    var d=eval("("+$(e).attr('data')+")"),D=eval("("+$(e).parent().attr('data')+")");
    $(e).parent().children('div').removeClass('cur');
    $(e).addClass('cur');
    delete this.schemes[D.no];
    this.schemes[D.no]={
      dan:false,
      name:D.name,
      h:D.h,
      g:D.g,
      no:D.no,
      v:[d.v],
      r:[d.r],
      n:[d.n]
    }
    this.chaipiao();
  },
  chaipiao:function(){
    var d={},t=[],k=0,p=[];
    for(i in this.schemes){
      k++;
      if(this.schemes[i].v.length==2){
        d=this.schemes[i];
      }else{
        t=this.schemes[i];
      }
    }
    if(k==2){
      p.push((t.r[0]*d.r[0]*2*this.mul).toFixed(2));
      p.push((t.r[0]*d.r[1]*2*this.mul).toFixed(2));
    }else{
      p=[0,0];
    }
    p.sort();
    this.money=(k-1)*4*this.mul;
    $("#mul").html(this.mul);
    $("#money").html(this.money);
    $("#PrizeCalc").html(p[0]+'－'+p[1]);
  },
  mul:5,
  setMul2:function(x){
    if(x==1){
      this.mul--
      if(this.mul<1){
        this.mul=1;
      }
    }else if(x==2){
      this.mul++;
      if(this.mul>9999){
        this.mul=9999;
      }
    }
    this.chaipiao();
  },
  setMul: function () {
    var t = $("#MulBox"),v=t.val();
    if (!t.val().isInt()) {
      v = 1;
    }
    else if (v > 9999) {
      v = 9999;
    }
    else if (v < 1) {
      v = 1;
    }
    else{
      v=t.val();
    }
    this.mul = v;
    cp2y.input.closeBox();
    this.chaipiao();
  },
  submit:function(isHemai){
    var p,content = [],
      scheme = this.schemes,
      i = 0;
    for (i in scheme){
      content.push(i+"`"+scheme[i].name+"`"+scheme[i].h+"`"+scheme[i].g+"`"+i+"_0`"+scheme[i].dan+"`"+scheme[i].v.join(','));
    }
    p = {
      lotteryId: _.bt,
      issueId: this.issue,
      issueIds: this.sels.join(","),
      issueCount: 1,
      multiple: this.mul,
      schemeNumber: "content=" + content.join("$"),
      schemeAmount: this.money,
      buyAmount: this.money,
      buyType: this.saleType,
      betType: this.betType,
      pass: this.passWay.join(','),
      sels: this.sels.join(","),
      cutRepeat: false
    };
    if(isHemai==1){//合买
      p.buyAmount=this.RenGou;
      p.safeguardMoney=this.BaoDi;//保底
      p.minParticipant=this.ZuiDiRenGou;//最少参与
      p.remuneration=this.YongJin;//佣金
      p.open=this.openStatus;//合买方案公开情况
      p.schemeDesc=$('#schemeDesc').val()//方案描述
    }
    $.ajax({
      url: WebAppUrl.HOME_APP_URL + "/core/lottery/buy_lottery",
      data: p,
      type: "post",
      dataType: "json",
      beforeSend: function () {
        cp2y.dialog.loading();
      },
      success: function (data) {
        cp2y.dialog.clearLoading();
        if (data.flag == -1) {
          return cp2y.quick.user.signInBox();
        }
        else if (data.flag == 2) {
          return cp2y.dialog.confirm("余额不足，去充值？", function () {
            cp2y.dialog.closeConfirm();
            location.href = WebAppUrl.HOME_APP_URL + '/recharge/index';
          });
        }
        else if (data.flag == 1) {
          location.href = WebAppUrl.HOME_APP_URL + '/lottery/detail#scheme=' + data.schemeId;
        }
        else {
          cp2y.dialog.alert(data.message);
        }
      }
    });
  }
};
$.extend(cp2y.buy,bd);
